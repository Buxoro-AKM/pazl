
<!doctype html>
<html lang="uz">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pazl O'yini</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #eef2ff, #fff);
            min-height: 100vh;
        }
        .puzzle-wrap {
            max-width: 480px;
            margin: 20px auto;
        }
        .board {
            display: grid;
            gap: 8px;
        }
        .tile {
            aspect-ratio: 1/1;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.12s ease;
        }
        .tile:active {
            transform: scale(0.97);
        }
        .empty {
            background: transparent;
            cursor: default;
        }
        #nameModal .modal-content {
            border-radius: 1rem;
        }
        #winModal .modal-content {
            text-align: center;
            border-radius: 1rem;
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            color: #fff;
        }

        .modal-backdrop.show {
            opacity: 0.95 !important; /* qoraroq effekt */
            background-color: #000000 !important;
            backdrop-filter: blur(6px); /* xira fon effekti */
        }

    </style>
</head>
<body>
<div class="container py-4">
    <div class="card shadow-sm puzzle-wrap">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                    <h5 class="card-title mb-0">Kitobni top o'yini</h5>
                </div>
                <div class="text-end">
                    <div id="status" class="small text-secondary">
                        Yurishlar: <span id="moves">0</span> â€¢ Vaqt: <span id="time">00:00</span>
                    </div>
                </div>
            </div>

            <div id="board" class="board mb-3"></div>

            <div class="d-flex flex-wrap controls">
                <div class="ms-auto d-flex align-items-center gap-2 mb-2">
                    <label class="small mb-0">O'lcham:</label>
                    <select id="sizeSel" class="form-select form-select-sm" style="width:80px">
                        <option value="3">3Ã—3</option>
                        <option value="4" selected>4Ã—4</option>
                        <option value="5">5Ã—5</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Name Modal -->
<div class="modal fade" id="nameModal" tabindex="-1" aria-labelledby="nameLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-4">
            <h5 id="nameLabel" class="mb-3">Ismingizni kiriting</h5>
            <input type="text" id="playerName" class="form-control mb-3" placeholder="Ismingiz">
            <button id="startBtn" class="btn btn-primary w-100">Boshlash</button>
        </div>
    </div>
</div>

<!-- Win Modal -->
<div class="modal fade" id="winModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-4">
            <h2 class="mb-3">ðŸŽ‰ Tabriklaymiz! ðŸŽ‰</h2>
            <h4 id="winnerName"></h4>
            <p id="bookName"></p>
            <p id="timeTaken"></p>
            <p id="moveCount"></p>
            <button class="btn btn-light w-100 mt-2" onclick="location.reload()">Qayta oâ€˜ynash</button>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const boardEl=document.getElementById('board');
    const movesEl=document.getElementById('moves');
    const timeEl=document.getElementById('time');
    const sizeSel=document.getElementById('sizeSel');
    const startBtn=document.getElementById('startBtn');
    const playerName=document.getElementById('playerName');
    const winnerName=document.getElementById('winnerName');
    const timeTaken=document.getElementById('timeTaken');
    const moveCount=document.getElementById('moveCount');
    const bookName=document.getElementById('bookName');

    let size=4,grid=[],emptyIndex=-1,moves=0,timerInterval=null,startTime=null;
    // let imgId=Math.floor(Math.random()*1000); // Har safar boshqacha rasm
    // let imgUrl=`https://picsum.photos/id/${imgId}/400`;
    let books = [
        "Jinoyat va Jazo",
        "O'tkan kunlar",
        "Mehrobdan chayon",
        "Xamsa",
        "Tib qonunlari",
        "Dunyoning ishlari",
        "Kecha va kunduz",
        "Tushda kechgan umrlar",
        "Otamdan qolgan dalalar",
        "Yulduzli tunlar",
        "Urush va tinchlik",
        "Chol va dengiz",
        "Garry Potter",
        "Suv ostida 80 ming kilometr"
    ]
    let imgId = Math.floor(Math.random() * books.length);
    let imgUrl=`Images/${imgId}.jpg`
    let imgName = books[imgId]
    let player="";

    function init(){
        createSolved();render();attachHandlers();
        const modal=new bootstrap.Modal(document.getElementById('nameModal'), {
            backdrop: 'static',   // orqa fon bosilganda yopilmasin
            keyboard: false       // Esc bosilganda ham yopilmasin
        });
        modal.show();
        startBtn.onclick=()=>{
            if(playerName.value.trim()==='')return;
            player=playerName.value.trim();
            modal.hide();
            shuffle(250);
        }
    }

    function createSolved(){
        grid=Array.from({length:size*size},(_,i)=>i+1);
        grid[grid.length-1]=0;
        emptyIndex=grid.length-1;
        moves=0;
        updateStats();
        stopTimer();
    }

    function render(){
        boardEl.innerHTML='';
        boardEl.style.gridTemplateColumns=`repeat(${size},1fr)`;
        grid.forEach((val,idx)=>{
            const tile=document.createElement('div');tile.className='tile';
            if(val===0){tile.classList.add('empty');}
            else{
                const row=Math.floor((val-1)/size);
                const col=(val-1)%size;
                tile.style.backgroundImage=`url(${imgUrl})`;
                tile.style.backgroundSize=`${size*100}% ${size*100}%`;
                tile.style.backgroundPosition=`${(col/(size-1))*100}% ${(row/(size-1))*100}%`;
                tile.addEventListener('click',()=>tryMove(idx));
            }
            boardEl.appendChild(tile);
        });
        updateStats();
    }

    function indexToRC(i){return{r:Math.floor(i/size),c:i%size}}
    function isAdjacent(i1,i2){const a=indexToRC(i1),b=indexToRC(i2);return (a.r===b.r&&Math.abs(a.c-b.c)===1)||(a.c===b.c&&Math.abs(a.r-b.r)===1)}

    function tryMove(idx){if(grid[idx]===0)return;if(isAdjacent(idx,emptyIndex))moveTile(idx)}

    function moveTile(idx){
        [grid[idx],grid[emptyIndex]]=[grid[emptyIndex],grid[idx]];
        emptyIndex=idx;
        moves++;
        updateStats();
        render();
        if(moves===1)startTimer();
        if(checkSolved())onWin();
    }

    function shuffle(n=200){
        stopTimer();moves=0;updateStats();
        for(let i=0;i<n;i++){
            const neighbors=[];
            const {r,c}=indexToRC(emptyIndex);
            if(c>0)neighbors.push(emptyIndex-1);
            if(c<size-1)neighbors.push(emptyIndex+1);
            if(r>0)neighbors.push(emptyIndex-size);
            if(r<size-1)neighbors.push(emptyIndex+size);
            const pick=neighbors[Math.floor(Math.random()*neighbors.length)];
            [grid[pick],grid[emptyIndex]]=[grid[emptyIndex],grid[pick]];
            emptyIndex=pick;
        }
        render();
        moves=0;
        updateStats();
        startTimer();
    }

    function updateStats(){movesEl.textContent=moves;}

    function checkSolved(){
        for(let i=0;i<grid.length-1;i++){if(grid[i]!==i+1)return false;}
        return grid[grid.length-1]===0;
    }

    function onWin(){
        stopTimer();
        const diff=Date.now()-startTime;
        winnerName.textContent=player+", siz yutdingiz!";
        timeTaken.textContent=`â±ï¸ Sarflangan vaqt: ${formatTime(diff)}`;
        moveCount.textContent=`ðŸš¶ Yurishlar soni: ${moves}`;
        bookName.textContent=`ðŸ“š Kitob nomi: ${imgName}`;
        const winModal=new bootstrap.Modal(document.getElementById('winModal'));
        winModal.show();
    }

    function startTimer(){
        if(timerInterval)return;
        startTime=Date.now();
        timerInterval=setInterval(()=>{
            const diff=Date.now()-startTime;
            timeEl.textContent=formatTime(diff);
        },250);
    }

    function stopTimer(){
        if(timerInterval)clearInterval(timerInterval);
        timerInterval=null;
        timeEl.textContent='00:00';
    }

    function formatTime(ms){
        const total=Math.floor(ms/1000);
        const m=Math.floor(total/60).toString().padStart(2,'0');
        const s=(total%60).toString().padStart(2,'0');
        return `${m}:${s}`;
    }

    function attachHandlers(){
        sizeSel.onchange=()=>{
            size=parseInt(sizeSel.value);
            createSolved();
            shuffle(250);
        }
    }

    init();
</script>
</body>
</html>
